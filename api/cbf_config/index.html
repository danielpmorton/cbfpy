
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Control Barrier Functions in Python">
      
      
      
        <link rel="canonical" href="https://danielpmorton.github.io/cbfpy/api/cbf_config/">
      
      
        <link rel="prev" href="../clf_cbf/">
      
      
        <link rel="next" href="../clf_cbf_config/">
      
      
      <link rel="icon" href="../../favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>CBF Config - CBFpy</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cbfpy.config.cbf_config" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CBFpy" class="md-header__button md-logo" aria-label="CBFpy" data-md-component="logo">
      
  <img src="../../logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CBFpy
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CBF Config
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/danielpmorton/cbfpy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    danielpmorton/cbfpy
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../cbf/" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CBFpy" class="md-nav__button md-logo" aria-label="CBFpy" data-md-component="logo">
      
  <img src="../../logo.svg" alt="logo">

    </a>
    CBFpy
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/danielpmorton/cbfpy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    danielpmorton/cbfpy
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pyenv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Virtual Environment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Highlights
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            API Highlights
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cbf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CBF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../clf_cbf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLF-CBF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    CBF Config
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    CBF Config
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config" class="md-nav__link">
    <span class="md-ellipsis">
      cbf_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--cbf-configuration-class" class="md-nav__link">
    <span class="md-ellipsis">
      CBF Configuration class
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CBF Configuration class">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--defining-the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      Defining the problem:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--tuning-the-cbf" class="md-nav__link">
    <span class="md-ellipsis">
      Tuning the CBF:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--relaxation" class="md-nav__link">
    <span class="md-ellipsis">
      Relaxation:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CBFConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CBFConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.f" class="md-nav__link">
    <span class="md-ellipsis">
      f
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.g" class="md-nav__link">
    <span class="md-ellipsis">
      g
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.h_1" class="md-nav__link">
    <span class="md-ellipsis">
      h_1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.h_2" class="md-nav__link">
    <span class="md-ellipsis">
      h_2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.alpha" class="md-nav__link">
    <span class="md-ellipsis">
      alpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.alpha_2" class="md-nav__link">
    <span class="md-ellipsis">
      alpha_2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.P" class="md-nav__link">
    <span class="md-ellipsis">
      P
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.q" class="md-nav__link">
    <span class="md-ellipsis">
      q
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../clf_cbf_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLF-CBF Config
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    CBFs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            CBFs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cbf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CBF
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../clf_cbf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLF-CBF
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Configuration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    CBF Config
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    CBF Config
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config" class="md-nav__link">
    <span class="md-ellipsis">
      cbf_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--cbf-configuration-class" class="md-nav__link">
    <span class="md-ellipsis">
      CBF Configuration class
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CBF Configuration class">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--defining-the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      Defining the problem:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--tuning-the-cbf" class="md-nav__link">
    <span class="md-ellipsis">
      Tuning the CBF:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--relaxation" class="md-nav__link">
    <span class="md-ellipsis">
      Relaxation:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CBFConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CBFConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.f" class="md-nav__link">
    <span class="md-ellipsis">
      f
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.g" class="md-nav__link">
    <span class="md-ellipsis">
      g
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.h_1" class="md-nav__link">
    <span class="md-ellipsis">
      h_1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.h_2" class="md-nav__link">
    <span class="md-ellipsis">
      h_2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.alpha" class="md-nav__link">
    <span class="md-ellipsis">
      alpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.alpha_2" class="md-nav__link">
    <span class="md-ellipsis">
      alpha_2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.P" class="md-nav__link">
    <span class="md-ellipsis">
      P
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.q" class="md-nav__link">
    <span class="md-ellipsis">
      q
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../clf_cbf_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CLF-CBF Config
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Environments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Environments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../base_env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base Env
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../car_env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cruise Control Env
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../point_robot_envs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Point Robot Envs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../drone_env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Drone Env
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../arm_envs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manipulator Envs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../acc_demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adaptive Cruise Control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../point_robot_demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Point Robot: Safe Set
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../point_robot_obstacle_demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Point Robot: Obstacle Avoidance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../drone_demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Drone Obstacle Avoidance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../joint_limits_demo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manipulator Joint Limits
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config" class="md-nav__link">
    <span class="md-ellipsis">
      cbf_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--cbf-configuration-class" class="md-nav__link">
    <span class="md-ellipsis">
      CBF Configuration class
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CBF Configuration class">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--defining-the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      Defining the problem:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--tuning-the-cbf" class="md-nav__link">
    <span class="md-ellipsis">
      Tuning the CBF:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config--relaxation" class="md-nav__link">
    <span class="md-ellipsis">
      Relaxation:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig" class="md-nav__link">
    <span class="md-ellipsis">
      CBFConfig
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CBFConfig">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.f" class="md-nav__link">
    <span class="md-ellipsis">
      f
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.g" class="md-nav__link">
    <span class="md-ellipsis">
      g
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.h_1" class="md-nav__link">
    <span class="md-ellipsis">
      h_1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.h_2" class="md-nav__link">
    <span class="md-ellipsis">
      h_2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.alpha" class="md-nav__link">
    <span class="md-ellipsis">
      alpha
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.alpha_2" class="md-nav__link">
    <span class="md-ellipsis">
      alpha_2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.P" class="md-nav__link">
    <span class="md-ellipsis">
      P
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cbfpy.config.cbf_config.CBFConfig.q" class="md-nav__link">
    <span class="md-ellipsis">
      q
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/danielpmorton/cbfpy/edit/master/docs/api/cbf_config.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/danielpmorton/cbfpy/raw/master/docs/api/cbf_config.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


  <h1>CBF Config</h1>

<div class="doc doc-object doc-module">



<a id="cbfpy.config.cbf_config"></a>
    <div class="doc doc-contents first">

        <h2 id="cbfpy.config.cbf_config--cbf-configuration-class">CBF Configuration class</h2>
<h3 id="cbfpy.config.cbf_config--defining-the-problem">Defining the problem:</h3>
<p>CBFs have two primary implementation requirements: the dynamics functions, and the barrier function(s).
These can be specified through the <code>f</code>, <code>g</code>, and <code>h</code> methods, respectively. Note that the main requirements
for these functions are that (1) the dynamics are control-affine, and (2) the barrier function(s) are "zeroing"
barriers, as opposed to "reciprocal" barriers. A zeroing barrier is one which is positive in the interior of the
safe set, and zero on the boundary.</p>
<p>Depending on the relative degree of your barrier function(s), you should implement the <code>h_1</code> method
(for a relative-degree-1 barrier), and/or the <code>h_2</code> method (for a relative-degree-2 barrier).</p>
<h3 id="cbfpy.config.cbf_config--tuning-the-cbf">Tuning the CBF:</h3>
<p>The CBF config provides a default implementation of the CBF "gain" function <code>alpha</code>, and <code>alpha_2</code> for
relative-degree-2 barriers. To change the sensitivity of the CBF, these functions can be modified to
increase or decrease the effect of the barrier(s). For instance, <code>alpha(h) = h</code> is the default implementation,
but to increase the sensitivity of the CBF, one could use <code>alpha(h) = 2 * h</code>. The only requirements for these
functions are that they are monotonically increasing and pass through the origin (class Kappa functions).</p>
<p>The CBFConfig also provides a default implementation of the CBF QP objective function, which is to minimize
the norm of the difference between the safe control input and the desired control input. This can also be modified
through the <code>P</code> and <code>q</code> methods, which define the quadratic and linear terms in the QP objective, respectively. This
does require that P is positive semi-definite.</p>
<h3 id="cbfpy.config.cbf_config--relaxation">Relaxation:</h3>
<p>Depending on the construction of the barrier functions and if control limits are provided, the CBF QP may not always be
feasible. If allowing for relaxation in the CBFConfig, a slack variable will be introduced to ensure that the
problem is always feasible, with a high penalty on any infeasibility. This is generally useful for controller
robustness, but means that safety is not guaranteed.</p>
<p>If strict enforcement of the CBF is desired, your higest-level controller should handle the case where the QP
is infeasible.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="cbfpy.config.cbf_config.CBFConfig" class="doc doc-heading">
            <code>CBFConfig</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Control Barrier Function (CBF) configuration class.</p>
<p>This is an abstract class which requires implementation of the following methods:</p>
<ul>
<li><code>f(z)</code>: The uncontrolled dynamics function</li>
<li><code>g(z)</code>: The control affine dynamics function</li>
<li><code>h_1(z)</code> and/or <code>h_2(z)</code>: The barrier function(s), of relative degree 1 and/or 2</li>
</ul>
<p>For finer-grained control over the CBF, the following methods may be updated from their defaults:</p>
<ul>
<li><code>alpha(h)</code>: "Gain" of the CBF</li>
<li><code>alpha_2(h_2)</code>: "Gain" of the relative-degree-2 CBFs, if applicable</li>
<li><code>P(z, u_des)</code>: Quadratic term in the CBF QP objective</li>
<li><code>q(z, u_des)</code>: Linear term in the CBF QP objective</li>
</ul>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>State dimension</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>m</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Control dimension</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_min</code>
            </td>
            <td>
                  <code><span title="jax.typing.ArrayLike">ArrayLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum control input, shape (m,). Defaults to None (Unconstrained).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_max</code>
            </td>
            <td>
                  <code><span title="jax.typing.ArrayLike">ArrayLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum control input, shape (m,). Defaults to None (Unconstrained).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relax_qp</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to allow for relaxation in the CBF QP. Defaults to True.
Note: this is required for differentiability through the QP.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cbf_relaxation_penalty</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Penalty on the CBF slack variables in the relaxed QP.
Defaults to 1e3. Note: only applies if relax_qp is True.</p>
              </div>
            </td>
            <td>
                  <code>1000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>control_relaxation_penalty</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Penalty on the control constraint slack variables in the
relaxed QP. Defaults to 1e5. Note: only applies if relax_qp is True.</p>
              </div>
            </td>
            <td>
                  <code>100000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>solver_tol</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tolerance for the QP solver. Defaults to 1e-3.</p>
              </div>
            </td>
            <td>
                  <code>0.001</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>init_args</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If your barrier function relies on additional arguments other than just the state,
include an initial seed for these arguments here. This is to help test the output of the barrier function.
Defaults to ().</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>cbfpy/config/cbf_config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CBFConfig</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Control Barrier Function (CBF) configuration class.</span>

<span class="sd">    This is an abstract class which requires implementation of the following methods:</span>

<span class="sd">    - `f(z)`: The uncontrolled dynamics function</span>
<span class="sd">    - `g(z)`: The control affine dynamics function</span>
<span class="sd">    - `h_1(z)` and/or `h_2(z)`: The barrier function(s), of relative degree 1 and/or 2</span>

<span class="sd">    For finer-grained control over the CBF, the following methods may be updated from their defaults:</span>

<span class="sd">    - `alpha(h)`: &quot;Gain&quot; of the CBF</span>
<span class="sd">    - `alpha_2(h_2)`: &quot;Gain&quot; of the relative-degree-2 CBFs, if applicable</span>
<span class="sd">    - `P(z, u_des)`: Quadratic term in the CBF QP objective</span>
<span class="sd">    - `q(z, u_des)`: Linear term in the CBF QP objective</span>

<span class="sd">    Args:</span>
<span class="sd">        n (int): State dimension</span>
<span class="sd">        m (int): Control dimension</span>
<span class="sd">        u_min (ArrayLike, optional): Minimum control input, shape (m,). Defaults to None (Unconstrained).</span>
<span class="sd">        u_max (ArrayLike, optional): Maximum control input, shape (m,). Defaults to None (Unconstrained).</span>
<span class="sd">        relax_qp (bool, optional): Whether to allow for relaxation in the CBF QP. Defaults to True.</span>
<span class="sd">            Note: this is required for differentiability through the QP.</span>
<span class="sd">        cbf_relaxation_penalty (float, optional): Penalty on the CBF slack variables in the relaxed QP.</span>
<span class="sd">            Defaults to 1e3. Note: only applies if relax_qp is True.</span>
<span class="sd">        control_relaxation_penalty (float, optional): Penalty on the control constraint slack variables in the</span>
<span class="sd">            relaxed QP. Defaults to 1e5. Note: only applies if relax_qp is True.</span>
<span class="sd">        solver_tol (float, optional): Tolerance for the QP solver. Defaults to 1e-3.</span>
<span class="sd">        init_args (tuple, optional): If your barrier function relies on additional arguments other than just the state,</span>
<span class="sd">            include an initial seed for these arguments here. This is to help test the output of the barrier function.</span>
<span class="sd">            Defaults to ().</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">u_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">u_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">relax_qp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">cbf_relaxation_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">,</span>
        <span class="n">control_relaxation_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e5</span><span class="p">,</span>
        <span class="n">solver_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
        <span class="n">init_args</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(),</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;n must be a positive integer. Got: </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;m must be a positive integer. Got: </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">relax_qp</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;relax_qp must be a boolean. Got: </span><span class="si">{</span><span class="n">relax_qp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relax_qp</span> <span class="o">=</span> <span class="n">relax_qp</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">cbf_relaxation_penalty</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
            <span class="ow">and</span> <span class="n">cbf_relaxation_penalty</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;CBF relaxation penalty must be a non-negative value. Got: </span><span class="si">{</span><span class="n">cbf_relaxation_penalty</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbf_relaxation_penalty</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cbf_relaxation_penalty</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">solver_tol</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="n">solver_tol</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;solver_tol must be a positive value. Got: </span><span class="si">{</span><span class="n">solver_tol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solver_tol</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">solver_tol</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver_tol</span> <span class="o">&gt;</span> <span class="mf">1e-2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;WARNING: solver tolerance is quite high (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">solver_tol</span><span class="si">}</span><span class="s2">). &quot;</span>
                <span class="o">+</span> <span class="s2">&quot; Solution will likely be poor.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_args</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;init_args must be a tuple. Got: </span><span class="si">{</span><span class="n">init_args</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_args</span> <span class="o">=</span> <span class="n">init_args</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">control_relaxation_penalty</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
            <span class="ow">and</span> <span class="n">control_relaxation_penalty</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;control_relaxation_penalty must be a non-negative value. Got: </span><span class="si">{</span><span class="n">control_relaxation_penalty</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_relaxation_penalty</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">control_relaxation_penalty</span><span class="p">)</span>

        <span class="c1"># Control limits require a bit of extra handling. They can be both None if unconstrained,</span>
        <span class="c1"># but we should not have one limit as None and the other as some value</span>
        <span class="n">u_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">u_min</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">if</span> <span class="n">u_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">u_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">u_max</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">if</span> <span class="n">u_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">u_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">u_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_constrained</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">u_min</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">u_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">u_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">u_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_constrained</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">u_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">u_min</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,)</span>
            <span class="n">u_min</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">u_min</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">u_max</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,)</span>
            <span class="n">u_max</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">u_max</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span> <span class="o">=</span> <span class="n">u_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span> <span class="o">=</span> <span class="n">u_max</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">control_constrained</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_relaxation_penalty</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbf_relaxation_penalty</span>
        <span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: Control constraints have a lower penalty than the CBFs.&quot;</span><span class="p">)</span>

        <span class="c1"># Test if the methods are provided and verify their output dimension</span>
        <span class="n">z_test</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="n">u_test</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
        <span class="n">f_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">z_test</span><span class="p">)</span>
        <span class="n">g_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">(</span><span class="n">z_test</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f_test</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid shape for f(z). Got </span><span class="si">{</span><span class="n">f_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, expected (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">,)&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">g_test</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid shape for g(z). Got </span><span class="si">{</span><span class="n">g_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, expected (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">h1_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_1</span><span class="p">(</span><span class="n">z_test</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">init_args</span><span class="p">)</span>
            <span class="n">h2_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_2</span><span class="p">(</span><span class="n">z_test</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">init_args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot test the barrier function; likely missing additional arguments.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Please provide an initial seed for these args in the config&#39;s init_args input&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">if</span> <span class="n">h1_test</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">h2_test</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Barrier function(s) must be 1D arrays&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_rd1_cbf</span> <span class="o">=</span> <span class="n">h1_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_rd2_cbf</span> <span class="o">=</span> <span class="n">h2_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cbf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rd1_cbf</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rd2_cbf</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cbf</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No barrier functions provided.&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You can implement this via the h_1 and/or h_2 methods in your config class&quot;</span>
            <span class="p">)</span>
        <span class="n">h_test</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">h1_test</span><span class="p">,</span> <span class="n">h2_test</span><span class="p">])</span>
        <span class="n">alpha_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">(</span><span class="n">h_test</span><span class="p">)</span>
        <span class="n">alpha_2_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_2</span><span class="p">(</span><span class="n">h2_test</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alpha_test</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbf</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid shape for alpha(h(z)): </span><span class="si">{</span><span class="n">alpha_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">. Expected (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbf</span><span class="si">}</span><span class="s2">,)&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Check that the output of the alpha() function matches the number of CBFs&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">alpha_2_test</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rd2_cbf</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid shape for alpha_2(h_2(z)): </span><span class="si">{</span><span class="n">alpha_2_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">. Expected (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rd2_cbf</span><span class="si">}</span><span class="s2">,)&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Check that the output of the alpha_2() function matches the number of RD2 CBFs&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_class_kappa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cbf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_class_kappa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rd2_cbf</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">P_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="n">z_test</span><span class="p">,</span> <span class="n">u_test</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">init_args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot test the P matrix; likely missing additional arguments.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="o">+</span> <span class="s2">&quot;Please provide an initial seed for these args in the config&#39;s init_args input&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
        <span class="k">if</span> <span class="n">P_test</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid shape for P(z). Got </span><span class="si">{</span><span class="n">P_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, expected (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_symmetric_psd</span><span class="p">(</span><span class="n">P_test</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;P matrix must be symmetric positive semi-definite&quot;</span><span class="p">)</span>

        <span class="c1"># Handle QP relaxation penalties, if relaxation is enabled</span>
        <span class="n">num_qp_constraints</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_cbf</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_constrained</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cbf</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_constrained</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constraint_relaxation_penalties</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cbf_relaxation_penalty</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbf</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">control_relaxation_penalty</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">constraint_relaxation_penalties</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbf_relaxation_penalty</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_cbf</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">constraint_relaxation_penalties</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_qp_constraints</span>

    <span class="c1">## Control Affine Dynamics ##</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The uncontrolled dynamics function. Possibly nonlinear, and locally Lipschitz</span>

<span class="sd">        i.e. the function f, such that z_dot = f(z) + g(z) u</span>

<span class="sd">        Args:</span>
<span class="sd">            z (ArrayLike): The state, shape (n,)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array: Uncontrolled state derivative component, shape (n,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The control affine dynamics function. Locally Lipschitz.</span>

<span class="sd">        i.e. the function g, such that z_dot = f(z) + g(z) u</span>

<span class="sd">        Args:</span>
<span class="sd">            z (ArrayLike): The state, shape (n,)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array: Control matrix, shape (n, m)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="c1">## Barriers ##</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">h_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Relative-degree-1 barrier function(s).</span>

<span class="sd">        A (zeroing) CBF is a continuously-differentiable function h, such that for any state z in the interior of</span>
<span class="sd">        the safe set, h(z) should be &gt; 0, and h(z) = 0 on the boundary. When in the unsafe set, h(z) &lt; 0.</span>

<span class="sd">        Relative degree can generally be thought of as the number of integrations required between the</span>
<span class="sd">        input and output of the system. For instance, a (relative-degree-1) CBF based on velocities,</span>
<span class="sd">        with acceleration inputs, will be directly modified on the next timestep.</span>

<span class="sd">        If your barrier function is relative-degree-2, or if you would like to enforce additional barriers</span>
<span class="sd">        which are relative-degree-2, use the `h_2` method.</span>

<span class="sd">        Args:</span>
<span class="sd">            z (ArrayLike): State, shape (n,)</span>
<span class="sd">            *h_args: Optional additional arguments for the barrier function. Note: If using additional args with your</span>
<span class="sd">                barrier, these must be a static shape/type, or else this will trigger a recompilation in Jax.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array: Barrier function(s), shape (num_rd1_barr,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">h_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Relative-degree-2 (high-order) barrier function(s).</span>

<span class="sd">        A (zeroing) CBF is a continuously-differentiable function h, such that for any state z in the interior of</span>
<span class="sd">        the safe set, h(z) should be &gt; 0, and h(z) = 0 on the boundary. When in the unsafe set, h(z) &lt; 0.</span>

<span class="sd">        Relative degree can generally be thought of as the number of integrations required between the</span>
<span class="sd">        input and output of the system. For instance, a (relative-degree-2) CBF based on position,</span>
<span class="sd">        with acceleration inputs, will be modified in two timesteps: the acceleration changes the velocity,</span>
<span class="sd">        which then changes the position.</span>

<span class="sd">        If your barrier function is relative-degree-1, or if you would like to enforce additional barriers</span>
<span class="sd">        which are relative-degree-1, use the `h_1` method.</span>

<span class="sd">        Args:</span>
<span class="sd">            z (ArrayLike): State, shape (n,)</span>
<span class="sd">            *h_args: Optional additional arguments for the barrier function. Note: If using additional args with your</span>
<span class="sd">                barrier, these must be a static shape/type, or else this will trigger a recompilation in Jax.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array: Barrier function(s), shape (num_rd2_barr,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

    <span class="c1">## Additional tuning functions ##</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A class Kappa function, dictating the &quot;gain&quot; of the barrier function(s)</span>

<span class="sd">        For reference, a class Kappa function is a monotonically increasing function which passes through the origin.</span>
<span class="sd">        A simple example is alpha(h) = h</span>

<span class="sd">        The default implementation can be overridden for more fine-grained control over the CBF</span>

<span class="sd">        Args:</span>
<span class="sd">            h (ArrayLike): Evaluation of the barrier function(s) at the current state, shape (num_cbf,)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array: alpha(h(z)), shape (num_cbf,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">h</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">alpha_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h_2</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A second class Kappa function which dictactes the &quot;gain&quot; associated with the relative-degree-2</span>
<span class="sd">        barrier functions</span>

<span class="sd">        For reference, a class Kappa function is a monotonically increasing function which passes through the origin.</span>
<span class="sd">        A simple example is alpha_2(h_2) = h_2</span>

<span class="sd">        The default implementation can be overridden for more fine-grained control over the CBF</span>

<span class="sd">        Args:</span>
<span class="sd">            h_2 (ArrayLike): Evaluation of the RD2 barrier function(s) at the current state, shape (num_rd2_cbf,)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array: alpha_2(h_2(z)), shape (num_rd2_cbf,).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">h_2</span>

    <span class="c1"># Objective function tuning</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">u_des</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Quadratic term in the CBF QP objective (minimize 0.5 * x^T P x + q^T x)</span>

<span class="sd">        This defaults to 2 * I, which is the value of P when minimizing the standard CBF objective,</span>
<span class="sd">        ||u - u_des||_{2}^{2}</span>

<span class="sd">        To change the objective, override this method. **Note that P must be PSD**</span>

<span class="sd">        Args:</span>
<span class="sd">            z (Array): State, shape (n,)</span>
<span class="sd">            u_des (Array): Desired control input, shape (m,)</span>
<span class="sd">            *h_args: Optional additional arguments for the barrier function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array: P matrix, shape (m, m)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">u_des</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Linear term in the CBF QP objective (minimize 0.5 * x^T P x + q^T x)</span>

<span class="sd">        This defaults to -2 * u_des, which is the value of q when minimizing the standard CBF objective,</span>
<span class="sd">        ||u - u_des||_{2}^{2}</span>

<span class="sd">        To change the objective, override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            z (Array): State, shape (n,)</span>
<span class="sd">            u_des (Array): Desired control input, shape (m,)</span>
<span class="sd">            *h_args: Optional additional arguments for the barrier function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Array: q vector, shape (m,)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u_des</span>

    <span class="c1">## Helper functions ##</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_class_kappa</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ArrayLike</span><span class="p">],</span> <span class="n">ArrayLike</span><span class="p">],</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks that the provided function is in class Kappa</span>

<span class="sd">        Args:</span>
<span class="sd">            func (Callable): Function to check</span>
<span class="sd">            dim (int): Expected dimension of the output</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Callable</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check that func(0) == 0</span>
            <span class="k">assert</span> <span class="n">jnp</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dim</span><span class="p">)),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="c1"># Check that func is monotonically increasing</span>
            <span class="n">n_test</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="n">test_points</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1e6</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">n_test</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_test</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)(</span><span class="n">test_points</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">jnp</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:])</span>
        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> does not appear to be a class Kappa function&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_symmetric_psd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mat</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that a matrix is symmetric positive semi-definite</span>

<span class="sd">        Args:</span>
<span class="sd">            mat (Array): Matrix to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the matrix is symmetric PSD, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
        <span class="c1"># Must be square</span>
        <span class="k">if</span> <span class="n">mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Must be symmetric or hermitian</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">mat</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Check PSD with cholesky. Cholesky can only tell if a matrix is PD, not PSD,</span>
        <span class="c1"># but adding a small regularization term will allow this test to work</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">mat</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1e-14</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="cbfpy.config.cbf_config.CBFConfig.f" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">f</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The uncontrolled dynamics function. Possibly nonlinear, and locally Lipschitz</p>
<p>i.e. the function f, such that z_dot = f(z) + g(z) u</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="jax.typing.ArrayLike">ArrayLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The state, shape (n,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Array</code></td>            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Uncontrolled state derivative component, shape (n,)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>cbfpy/config/cbf_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The uncontrolled dynamics function. Possibly nonlinear, and locally Lipschitz</span>

<span class="sd">    i.e. the function f, such that z_dot = f(z) + g(z) u</span>

<span class="sd">    Args:</span>
<span class="sd">        z (ArrayLike): The state, shape (n,)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array: Uncontrolled state derivative component, shape (n,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cbfpy.config.cbf_config.CBFConfig.g" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">g</span><span class="p">(</span><span class="n">z</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The control affine dynamics function. Locally Lipschitz.</p>
<p>i.e. the function g, such that z_dot = f(z) + g(z) u</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="jax.typing.ArrayLike">ArrayLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The state, shape (n,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Array</code></td>            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Control matrix, shape (n, m)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>cbfpy/config/cbf_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The control affine dynamics function. Locally Lipschitz.</span>

<span class="sd">    i.e. the function g, such that z_dot = f(z) + g(z) u</span>

<span class="sd">    Args:</span>
<span class="sd">        z (ArrayLike): The state, shape (n,)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array: Control matrix, shape (n, m)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cbfpy.config.cbf_config.CBFConfig.h_1" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">h_1</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Relative-degree-1 barrier function(s).</p>
<p>A (zeroing) CBF is a continuously-differentiable function h, such that for any state z in the interior of
the safe set, h(z) should be &gt; 0, and h(z) = 0 on the boundary. When in the unsafe set, h(z) &lt; 0.</p>
<p>Relative degree can generally be thought of as the number of integrations required between the
input and output of the system. For instance, a (relative-degree-1) CBF based on velocities,
with acceleration inputs, will be directly modified on the next timestep.</p>
<p>If your barrier function is relative-degree-2, or if you would like to enforce additional barriers
which are relative-degree-2, use the <code>h_2</code> method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="jax.typing.ArrayLike">ArrayLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>State, shape (n,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*h_args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional additional arguments for the barrier function. Note: If using additional args with your
barrier, these must be a static shape/type, or else this will trigger a recompilation in Jax.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Array</code></td>            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Barrier function(s), shape (num_rd1_barr,)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>cbfpy/config/cbf_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">h_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Relative-degree-1 barrier function(s).</span>

<span class="sd">    A (zeroing) CBF is a continuously-differentiable function h, such that for any state z in the interior of</span>
<span class="sd">    the safe set, h(z) should be &gt; 0, and h(z) = 0 on the boundary. When in the unsafe set, h(z) &lt; 0.</span>

<span class="sd">    Relative degree can generally be thought of as the number of integrations required between the</span>
<span class="sd">    input and output of the system. For instance, a (relative-degree-1) CBF based on velocities,</span>
<span class="sd">    with acceleration inputs, will be directly modified on the next timestep.</span>

<span class="sd">    If your barrier function is relative-degree-2, or if you would like to enforce additional barriers</span>
<span class="sd">    which are relative-degree-2, use the `h_2` method.</span>

<span class="sd">    Args:</span>
<span class="sd">        z (ArrayLike): State, shape (n,)</span>
<span class="sd">        *h_args: Optional additional arguments for the barrier function. Note: If using additional args with your</span>
<span class="sd">            barrier, these must be a static shape/type, or else this will trigger a recompilation in Jax.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array: Barrier function(s), shape (num_rd1_barr,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cbfpy.config.cbf_config.CBFConfig.h_2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">h_2</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Relative-degree-2 (high-order) barrier function(s).</p>
<p>A (zeroing) CBF is a continuously-differentiable function h, such that for any state z in the interior of
the safe set, h(z) should be &gt; 0, and h(z) = 0 on the boundary. When in the unsafe set, h(z) &lt; 0.</p>
<p>Relative degree can generally be thought of as the number of integrations required between the
input and output of the system. For instance, a (relative-degree-2) CBF based on position,
with acceleration inputs, will be modified in two timesteps: the acceleration changes the velocity,
which then changes the position.</p>
<p>If your barrier function is relative-degree-1, or if you would like to enforce additional barriers
which are relative-degree-1, use the <code>h_1</code> method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="jax.typing.ArrayLike">ArrayLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>State, shape (n,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*h_args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional additional arguments for the barrier function. Note: If using additional args with your
barrier, these must be a static shape/type, or else this will trigger a recompilation in Jax.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Array</code></td>            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Barrier function(s), shape (num_rd2_barr,)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>cbfpy/config/cbf_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">h_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Relative-degree-2 (high-order) barrier function(s).</span>

<span class="sd">    A (zeroing) CBF is a continuously-differentiable function h, such that for any state z in the interior of</span>
<span class="sd">    the safe set, h(z) should be &gt; 0, and h(z) = 0 on the boundary. When in the unsafe set, h(z) &lt; 0.</span>

<span class="sd">    Relative degree can generally be thought of as the number of integrations required between the</span>
<span class="sd">    input and output of the system. For instance, a (relative-degree-2) CBF based on position,</span>
<span class="sd">    with acceleration inputs, will be modified in two timesteps: the acceleration changes the velocity,</span>
<span class="sd">    which then changes the position.</span>

<span class="sd">    If your barrier function is relative-degree-1, or if you would like to enforce additional barriers</span>
<span class="sd">    which are relative-degree-1, use the `h_1` method.</span>

<span class="sd">    Args:</span>
<span class="sd">        z (ArrayLike): State, shape (n,)</span>
<span class="sd">        *h_args: Optional additional arguments for the barrier function. Note: If using additional args with your</span>
<span class="sd">            barrier, these must be a static shape/type, or else this will trigger a recompilation in Jax.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array: Barrier function(s), shape (num_rd2_barr,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cbfpy.config.cbf_config.CBFConfig.alpha" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">alpha</span><span class="p">(</span><span class="n">h</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A class Kappa function, dictating the "gain" of the barrier function(s)</p>
<p>For reference, a class Kappa function is a monotonically increasing function which passes through the origin.
A simple example is alpha(h) = h</p>
<p>The default implementation can be overridden for more fine-grained control over the CBF</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>h</code>
            </td>
            <td>
                  <code><span title="jax.typing.ArrayLike">ArrayLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Evaluation of the barrier function(s) at the current state, shape (num_cbf,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Array</code></td>            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>alpha(h(z)), shape (num_cbf,)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>cbfpy/config/cbf_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class Kappa function, dictating the &quot;gain&quot; of the barrier function(s)</span>

<span class="sd">    For reference, a class Kappa function is a monotonically increasing function which passes through the origin.</span>
<span class="sd">    A simple example is alpha(h) = h</span>

<span class="sd">    The default implementation can be overridden for more fine-grained control over the CBF</span>

<span class="sd">    Args:</span>
<span class="sd">        h (ArrayLike): Evaluation of the barrier function(s) at the current state, shape (num_cbf,)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array: alpha(h(z)), shape (num_cbf,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cbfpy.config.cbf_config.CBFConfig.alpha_2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">alpha_2</span><span class="p">(</span><span class="n">h_2</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>A second class Kappa function which dictactes the "gain" associated with the relative-degree-2
barrier functions</p>
<p>For reference, a class Kappa function is a monotonically increasing function which passes through the origin.
A simple example is alpha_2(h_2) = h_2</p>
<p>The default implementation can be overridden for more fine-grained control over the CBF</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>h_2</code>
            </td>
            <td>
                  <code><span title="jax.typing.ArrayLike">ArrayLike</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Evaluation of the RD2 barrier function(s) at the current state, shape (num_rd2_cbf,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Array</code></td>            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>alpha_2(h_2(z)), shape (num_rd2_cbf,).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>cbfpy/config/cbf_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">alpha_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h_2</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A second class Kappa function which dictactes the &quot;gain&quot; associated with the relative-degree-2</span>
<span class="sd">    barrier functions</span>

<span class="sd">    For reference, a class Kappa function is a monotonically increasing function which passes through the origin.</span>
<span class="sd">    A simple example is alpha_2(h_2) = h_2</span>

<span class="sd">    The default implementation can be overridden for more fine-grained control over the CBF</span>

<span class="sd">    Args:</span>
<span class="sd">        h_2 (ArrayLike): Evaluation of the RD2 barrier function(s) at the current state, shape (num_rd2_cbf,)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array: alpha_2(h_2(z)), shape (num_rd2_cbf,).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">h_2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cbfpy.config.cbf_config.CBFConfig.P" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">P</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">u_des</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Quadratic term in the CBF QP objective (minimize 0.5 * x^T P x + q^T x)</p>
<p>This defaults to 2 * I, which is the value of P when minimizing the standard CBF objective,
||u - u_des||_{2}^{2}</p>
<p>To change the objective, override this method. <strong>Note that P must be PSD</strong></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>State, shape (n,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_des</code>
            </td>
            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired control input, shape (m,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*h_args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional additional arguments for the barrier function.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Array</code></td>            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>P matrix, shape (m, m)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>cbfpy/config/cbf_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">u_des</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Quadratic term in the CBF QP objective (minimize 0.5 * x^T P x + q^T x)</span>

<span class="sd">    This defaults to 2 * I, which is the value of P when minimizing the standard CBF objective,</span>
<span class="sd">    ||u - u_des||_{2}^{2}</span>

<span class="sd">    To change the objective, override this method. **Note that P must be PSD**</span>

<span class="sd">    Args:</span>
<span class="sd">        z (Array): State, shape (n,)</span>
<span class="sd">        u_des (Array): Desired control input, shape (m,)</span>
<span class="sd">        *h_args: Optional additional arguments for the barrier function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array: P matrix, shape (m, m)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cbfpy.config.cbf_config.CBFConfig.q" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">q</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">u_des</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Linear term in the CBF QP objective (minimize 0.5 * x^T P x + q^T x)</p>
<p>This defaults to -2 * u_des, which is the value of q when minimizing the standard CBF objective,
||u - u_des||_{2}^{2}</p>
<p>To change the objective, override this method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>State, shape (n,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u_des</code>
            </td>
            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired control input, shape (m,)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>*h_args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional additional arguments for the barrier function.</p>
              </div>
            </td>
            <td>
                  <code>()</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Array</code></td>            <td>
                  <code><span title="jax.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>q vector, shape (m,)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>cbfpy/config/cbf_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">u_des</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="o">*</span><span class="n">h_args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Linear term in the CBF QP objective (minimize 0.5 * x^T P x + q^T x)</span>

<span class="sd">    This defaults to -2 * u_des, which is the value of q when minimizing the standard CBF objective,</span>
<span class="sd">    ||u - u_des||_{2}^{2}</span>

<span class="sd">    To change the objective, override this method.</span>

<span class="sd">    Args:</span>
<span class="sd">        z (Array): State, shape (n,)</span>
<span class="sd">        u_des (Array): Desired control input, shape (m,)</span>
<span class="sd">        *h_args: Optional additional arguments for the barrier function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array: q vector, shape (m,)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u_des</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../clf_cbf/" class="md-footer__link md-footer__link--prev" aria-label="Previous: CLF-CBF">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                CLF-CBF
              </div>
            </div>
          </a>
        
        
          
          <a href="../clf_cbf_config/" class="md-footer__link md-footer__link--next" aria-label="Next: CLF-CBF Config">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                CLF-CBF Config
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>